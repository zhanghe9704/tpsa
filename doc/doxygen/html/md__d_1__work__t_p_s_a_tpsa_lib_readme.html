<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TPSA_LIB: C++ TPSA Lib</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TPSA_LIB
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">C++ TPSA Lib </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Announcement</h2>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
<h2>About this code</h2>
<p>This code allows users to do computations using Truncated Power Series Algebra (TPSA) and/or Differential Algebra (DA).</p>
<p>For TPSA and DA, please refer to chapter 8 in <a href="http://inspirehep.net/record/595287/files/slac-pub-9574.pdf"><em>Lecture Notes on Special Topics in Accelerator Physics</em></a> by Prof. Alex Chao and chapter 2 in <a href="http://bt.pa.msu.edu/cgi-bin/display.pl?name=AIEP108book"><em>Modern Map Methods in Particle Beam Physics</em></a> by Prof. Martin Berz.</p>
<p>This code is developed based on Dr. Lingyun Yang's tpsa codes in C++ . His codes (<a class="el" href="tpsa_8cpp.html" title="Automatic Differentiation Test.">tpsa.cpp</a> and <a class="el" href="tpsa_8h.html" title="Automatic Differentiation.">tpsa.h</a>) are included in this repository. They are untouched, except for a few functions that are commented off and replaced by functions in <a class="el" href="tpsa__extend_8cc.html" title="Extend the original tpsa.cpp file by Dr. Lingyun Yang.">tpsa_extend.cc</a>. Please get permission from Dr. Lingyun Yang before you redistribute <a class="el" href="tpsa_8cpp.html" title="Automatic Differentiation Test.">tpsa.cpp</a> and <a class="el" href="tpsa_8h.html" title="Automatic Differentiation.">tpsa.h</a>.</p>
<p>The major change is the memory management. The current memory management works in the following way. Before any TPSA/DA calculation, one needs to reserve the memory for $n$ TPS vector. A memory pool is allocated in the heap, which can be considered as $n$ slots, each for one TPS vector. A linked list is created to reference the available (unused) slots. Two pointers point to the beginning and the end of the linked list respectively. When a new TPS vector is created, the first slot will be assigned to it and the beginning pointer points to the following slot in the linked list. When a TPS vector goes out of its scope, the slot will be reset to empty and liked to the end of the list. The end pointer will be updated and point to the new end.</p>
<img src="doc/tpsa_memory_management.png" alt="Memory management" class="inline"/>
<p>A new data type <a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a> is created as a wrapper of the TPS vector. The following mathematical operator and functions are overloaded for <a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>, so that a variable of <a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a> type can be used as a intrinsic type in calculations.</p>
<p>Math operator overloaded</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Left hand  </th><th class="markdownTableHeadCenter">Operator  </th><th class="markdownTableHeadCenter">Right hand   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">+  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">double  </td><td class="markdownTableBodyCenter">+  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">+  </td><td class="markdownTableBodyCenter">double   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter">double   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">double  </td><td class="markdownTableBodyCenter">-  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">*  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">*  </td><td class="markdownTableBodyCenter">double   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">double  </td><td class="markdownTableBodyCenter">*  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">/  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">/  </td><td class="markdownTableBodyCenter">double   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">double  </td><td class="markdownTableBodyCenter">/  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">=  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">=  </td><td class="markdownTableBodyCenter">double   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">+=  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">+=  </td><td class="markdownTableBodyCenter">double   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">-=  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">-=  </td><td class="markdownTableBodyCenter">double   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">*=  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">*=  </td><td class="markdownTableBodyCenter">double   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">/=  </td><td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="struct_d_a_vector.html" title="Differential Algebra (DA) Vector A TPS vector with methods. Can be used with most numerical operators...">DAVector</a>  </td><td class="markdownTableBodyCenter">/=  </td><td class="markdownTableBodyCenter">double   </td></tr>
</table>
<p>Math functions overloaded:</p>
<ul>
<li>sqrt</li>
<li>exp</li>
<li>log</li>
<li>sin</li>
<li>cos</li>
<li>pow</li>
<li>abs</li>
</ul>
<p>Some test results for efficiency are presented in the following. They are done in a Windows 10 desktop with Intel Xeon (R) E5-1620 processor at 3.60 GHz. Table 1 shows the time cost for composition of one DA/TPS vector of six bases with six DA/TPS vectors. First column shows the order of the vectors, second column the number of terms in each vector, third column the time using the DA data type with revised memory management, and the fourth column the time using the original code. Table 2 shows the time of composition of six DA vectors, each having six bases, with the other group of six DA vectors. The composition in group cost less time if compared with separate compositions.</p>
<p>Table 1. Time (in second) of composition</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Order  </th><th class="markdownTableHeadNone">No. of terms  </th><th class="markdownTableHeadNone">DA  </th><th class="markdownTableHeadNone">TPSA   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">28  </td><td class="markdownTableBodyNone">$7.57\times 10^{-6}$  </td><td class="markdownTableBodyNone">$6.25\times 10^{-6}$   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">210  </td><td class="markdownTableBodyNone">$7.50\times 10^{-4}$  </td><td class="markdownTableBodyNone">$1.44\times 10^{-2}$   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6  </td><td class="markdownTableBodyNone">924  </td><td class="markdownTableBodyNone">$4.48 \times 10^{-3}$  </td><td class="markdownTableBodyNone">$8.39\times 10^{-2}$   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">8  </td><td class="markdownTableBodyNone">3003  </td><td class="markdownTableBodyNone">$9.90 \times 10^{-1}$  </td><td class="markdownTableBodyNone">$2.55$   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">8008  </td><td class="markdownTableBodyNone">$15.49$  </td><td class="markdownTableBodyNone">$44.60$   </td></tr>
</table>
<p>Table 2. Time (in second) of group composition</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Order  </th><th class="markdownTableHeadNone">DA   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">$1.51\times 10^{-5}$   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">$1.04\times 10^{-3}$   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6  </td><td class="markdownTableBodyNone">$4.42\times 10^{-2}$   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">8  </td><td class="markdownTableBodyNone">$1.05$   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">10  </td><td class="markdownTableBodyNone">$16.04$   </td></tr>
</table>
<p>More information is available at doc/doxygen/html/index.html.</p>
<h2>How to compile and use this code</h2>
<p>You will need a C++ compiler that supports C++ 11 standard. There are three ways to use the code as follows:</p>
<ul>
<li>Download the source files. Include "tpsa_extend.h" and "da.h" in your project and compile.</li>
<li>The code is developed using Code::Blocks IDE. There are two C::B profiles under the cbp directory: tpsa_lib.cbp and tpsa_dll.cbp for static library and dynamic library respectively. The cbp files are tested in Windows 10 with gcc compiler.</li>
<li><p class="startli">You can also use cmake to compile the code into both a static library and a dynamic library. This is only tested in Ubuntu 16.04.</p>
<p class="startli"><code>cmake .</code> <code>make</code></p>
<p class="startli">Here is an example of compiling the code under Ubuntu 16.04.</p>
<p class="startli">Assume I have cloned the codes to the following folder:</p>
<p class="startli">$HOME/tpsa</p>
<p class="startli">Inside the above folder, run:</p>
<p class="startli"><code>cmake .</code></p>
<p class="startli">The Makefile will be generated.</p>
<p class="startli">Then run:</p>
<p class="startli"><code>make</code></p>
<p class="startli">Both the static lib and the shared lib of tpsa will be generated. You can find the following two files:</p>
<p class="startli">libtpsa.a and libtpsaso.so</p>
<p class="startli">Now you can use any of them to compile your file. Here let us compile the examples/examples.cc using libtpsa.a.</p>
<p class="startli"><code>gcc examples/examples.cc -o tpsa_exp -I ./include/ -L ./lib -ltpsa -lstdc++ -lm -std=c++11</code></p>
<p class="startli">You can also use libtpsaso.so.</p>
<p class="startli"><code>gcc examples/examples.cc -o tpsa_exp -std=c++11 -Iinclude -L. -ltpsaso -lstdc++ -lm</code></p>
<p class="startli">The executable file tpsa_exp will be generated.</p>
<p class="startli">To run the tpsa_exp file, tell the OS where to find the libtpsaso.so:</p>
<p class="startli"><code>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/tpsa</code></p>
<p class="startli">Run the executable:</p>
<p class="startli"><code>./tpsa_exp</code></p>
<p class="startli">The result is shown as follows: V [16]              Base  [ 4 / 286 ]</p>
</li>
</ul>
<hr/>
<p>1.000000000000000e+00      0  0  0     0 </p>
<p>-1.000000000000000e+00      1  0  0     1   </p>
<p>2.000000000000000e+00      0  1  0     2   </p>
<p>5.000000000000000e-01       0  0  1     3</p>
<p>......</p>
<h3>Known Issues</h3>
<ol type="1">
<li>sin() and cos() will set the length of the DA vector to be the full length. However, if the number of the bases used in the vector is smaller than the total base number, the real length of the DA vector could be less than the full length. For example, assuming a DA space with three bases (da[0], da[1], and da[2]) and a vector that only contains one base, such as x = 1 + da[0], the length of sin(x) or cos(x) will be shorter than the full vector length. This does not necessarily affect the final result of the computation. Needs to fix ad_sin and ad_cos in <a class="el" href="tpsa_8cpp.html" title="Automatic Differentiation Test.">tpsa.cpp</a></li>
</ol>
<h2>Acknowledgement</h2>
<p>Thanks to Dr. Lingyun Yang for providing his tpsa code.</p>
<h2>Contact</h2>
<p>Contact the author by hezhang.AT.jlab.org. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
